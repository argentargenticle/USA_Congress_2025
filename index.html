<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main Congress Page</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .w3-theme-d5 {color:#fff !important; background-color:#362e4a !important}
    </style>
</head>
<body>
    <nav class="w3-bar w3-theme-d5">
        <a href="#" class="w3-bar-item w3-button w3-mobile">Home</a>
        <label>
            <input type="text" id="searchInput" class="w3-bar-item w3-input w3-mobile"
                   placeholder="Search Representative Name">
        </label>
        <a href="#" class="w3-bar-item w3-button w3-deep-purple w3-mobile">Search</a>
    </nav>
    
    <div class="w3-container">
        <div id="loading" class="w3-container">
            <h2>Display Congress Members</h2>
            <p>Use the search bar above to find specific members of congress. You can search by name or state. Once you find a member, click on their name to view their profile.</p>
            <p>Each member of congress has a profile which includes their name, state, committees they are a part of, and their position in the hemicycle.</p>
        </div>
        <div id="membersContainer" class="w3-grid-padding w3-padding-16" style="grid-template-columns:auto auto auto">
            <!-- Members will be loaded here -->
        </div>
    </div>
    <footer class="w3-container w3-theme-d5">
        <p>Created by Argenticle &copy; 2025</p>
    </footer>

    <script>
    $(document).ready(function() {
        // Cache jQuery selectors - using class selector instead of ID for the search button
        const $loading = $('#loading');
        const $membersContainer = $('#membersContainer');
        const $searchInput = $('#searchInput');
        const $searchBtn = $('.w3-deep-purple.w3-button'); // Using class selector instead of ID
        
        // Show loading container by default
        $loading.show();
        $membersContainer.empty();
        
        // Search functionality
        $searchBtn.click(function() {
            const searchTerm = $searchInput.val().trim();
            if (searchTerm) loadMembers();
        });
        
        $searchInput.on('keypress', function(e) {
            if (e.which === 13) {
                const searchTerm = $(this).val().trim();
                if (searchTerm) loadMembers();
            }
        });
        
        function loadMembers() {
            const searchTerm = $searchInput.val().toLowerCase();
            $loading.show();

            $.ajax({
                url: 'https://unitedstates.github.io/congress-legislators/legislators-current.json',
                method: 'GET',
                dataType: 'json'
            })
            .done(function(response) {
                if (response && response.length > 0) {
                    displayMembers(response, searchTerm);
                }
            })
            .fail(function() {
                $membersContainer.html('<div class="w3-panel w3-red">Error loading members</div>');
            })
            .always(function() {
                $loading.hide();
            });
        }

        function displayMembers(members, searchTerm = '') {
            // Always hide the loading container when processing a search
            $loading.hide();
            $membersContainer.empty();

            // If no search term, show the loading container with instructions
            if (!searchTerm) {
                $loading.show();
                return [];
            }

            const filtered = members.filter(member => {
                
                const name = (member && member.name && 
                            (member.name['official_full'] || 
                             (member.name.first && member.name.last ? 
                              `${member.name.first} ${member.name.last}` : '')) || '').toLowerCase();
                const firstTerm = member && member['terms'] && member['terms'][0] ? member['terms'][0] : {};
                const state = firstTerm['state'] ? String(firstTerm['state']).toLowerCase() : '';
                const district = firstTerm['district'] ? `district ${firstTerm['district']}` : '';
                const party = firstTerm['party'] ? String(firstTerm['party']).toLowerCase() : '';
                const searchLower = searchTerm.toLowerCase().trim();
                
                return name.includes(searchLower) || 
                       state.includes(searchLower) ||
                       district.includes(searchLower) ||
                       party.includes(searchLower);
            });

            if (filtered.length === 0) {
                $membersContainer.html('<div class="w3-panel w3-padding-16 w3-yellow"><h4>No members found</h4></div>');
                return;
            }

            filtered.forEach(member => {
                // Format name from the API response
                const name = (member && member.name && 
                            (member.name['official_full'] || 
                             (member.name.first && member.name.last ? 
                              `${member.name.first} ${member.name.last}` : '')) || 'Unknown Member');
                const card = `
                   <div class="w3-card-2 w3-hover-shadow ${member['terms'] && member['terms'][0] && member['terms'][0]['party'] === 'Democrat' ? 'w3-blue' :
                    member['terms'] && member['terms'][0] && member['terms'][0]['party'] === 'Republican' ? 'w3-red' : 'w3-purple'}" style="display: flex; align-items: center;">
                        <div class="w3-margin-right w3-margin" style="flex: 0 0 auto;">
                            <img class="w3-round-xlarge w3-image member-photo" 
                                src="${member && member['id'] && member['id']['bioguide'] ? 
                    `https://bioguide.congress.gov/bioguide/photo/${member['id']['bioguide'].charAt(0)}/${member['id']['bioguide']}.jpg` : 'https://placehold.co/200x240/000000/FFFFFF/png'}" 
                                alt="${name}" 
                                style="width: auto; height: 240px; object-fit: cover;"
                                data-fallback-src="https://placehold.co/160x200/000000/FFFFFF/png">
                        </div>
                        <div class="w3-padding" style="flex: 1; display: flex; flex-direction: column; justify-content: center; height: 100%;">
                            <div class="w3-center w3-white w3-margin w3-padding-16 w3-round-xlarge">
                                <header class="w3-container">
                                    <h4>${name}</h4>
                                </header>
                                <p class="w3-round" style="margin: 5px 0 10px 0;">
                                    ${member['terms'] && member['terms'][0] && member['terms'][0]['type'] === 'rep' ? 'House of Representatives' : 'Senate'}
                                </p>
                                <p>${member['terms'] && member['terms'][0] ? (member['terms'][0]['party'] || 'Unknown') : 'Unknown'} - ${member['terms'] && member['terms'][0] ? (member['terms'][0]['state'] || 'N/A') : 'N/A'}</p>
                                <p>${member['terms'] && member['terms'][0] && member['terms'][0]['district'] ? `District ${member['terms'][0]['district']}` : 'At-Large'}</p>
                                <a href="#" class="w3-button w3-round-large w3-black w3-hover-deep-purple">More Info</a>
                            </div>
                       </div>
                   </div>
                `;
                $membersContainer.append(card);
            });
            
            // Add error handling for member photos
            document.querySelectorAll('.member-photo').forEach(img => {
                img.addEventListener('error', function() {
                    const fallbackSrc = this.getAttribute('data-fallback-src');
                    if (this.src !== fallbackSrc) {
                        this.src = fallbackSrc;
                    }
                });
            });
        }
    });
    </script>
</body>
</html>
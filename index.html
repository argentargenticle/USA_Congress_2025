<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Basic Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/congress.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #6610f2;" data-bs-theme="dark">
    <div class="container">
        <a class="navbar-brand" href="#" aria-label="Home">
            <i class="fa-solid fa-house"></i>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto gap-3">
                <li class="nav-item">
                    <a class="nav-link" href="#"><i class="fas fa-landmark me-2"></i>House</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="senateLink"><i class="fas fa-scale-balanced me-2"></i>Senate</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Committees</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Legislation</a>
                </li>
            </ul>
            <form id="navbarSearchForm" class="d-flex ms-auto" role="search">
                <input id="navbarSearchInput" class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>
                <button class="btn" style="--bs-btn-bg: #290661;" type="submit" aria-label="Search">
                    <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
                    <span class="visually-hidden">Search</span>
                </button>
            </form>
        </div>
    </div>
</nav>

<main class="container my-4">
    <section id="main" class="container">
        <h2>Welcome</h2>
        <p>This is a minimal, responsive HTML template with a header, main, and footer.</p>
        <p>Edit this content to get started.</p>
    </section>

    <!-- Search results will be injected here -->
    <div id="searchResults" class="container g-3"></div>
</main>
<footer class="container py-3 text-muted border-top">
    <small>Argenticle @Copyright 2025 </small>
</footer>
<script>
  // jQuery: handle search submit from button click or Enter key
  $(function () {
    $('#navbarSearchForm').on('submit', function (e) {
      e.preventDefault();
      const query = $('#navbarSearchInput').val().trim();
      handleSearch(query);
    });

    // Placeholder you can customize. Replace with your real logic.
    window.handleSearch = function (query) {
      const $results = $('#searchResults');
      if (!query) {
        const alertHtml =
          '<div class="alert alert-warning alert-dismissible fade show mt-3" role="alert">\
            Please enter a search term.\
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\
          </div>';
        // Show only one warning and replace any existing danger
        $results.find('.alert-warning, .alert-danger').remove();
        $results.prepend(alertHtml);
        $('#navbarSearchInput').trigger('focus');
        return;
      }
      // Clear previous results for new search
      $results.empty();

      // Load dataset on demand (first search) then rerun
      if (!window.congress || !Array.isArray(window.congress.legislators)) {
        $.getJSON('https://unitedstates.github.io/congress-legislators/legislators-current.json')
          .done(function (data) {
            window.congress = window.congress || {};
            window.congress.legislators = data;
            // Re-run now that data is available
            handleSearch(query);
          })
          .fail(function (xhr) {
            const msg = (xhr && xhr.status === 404)
              ? 'Dataset not found (404).'
              : (xhr && xhr.status === 0 ? 'Cannot load dataset (blocked/offline).' : 'Failed to load dataset.');
            // Replace any existing warning/danger so only one alert is shown
            $results.find('.alert-warning, .alert-danger').remove();
            $results.prepend('<div class="alert alert-danger mt-3" role="alert">' + msg + '</div>');
          });
        return;
      }

      // Step 1: Find all matching Representatives by name substring (tolerant to middle names/initials)
      // Try to use loaded dataset if available on window.congress.legislators
      let matches = [];
      try {
        const data = (window.congress && Array.isArray(window.congress.legislators)) ? window.congress.legislators : null;
        if (data) {
          const normalize = function (s) { return (s || '').toLowerCase().replace(/[^a-z]/g, ''); };
          const qNorm = normalize(query);
          const qParts = query.trim().toLowerCase().split(/\s+/);
          const qFirst = normalize(qParts[0] || '');
          const qLast = normalize(qParts[qParts.length - 1] || '');

          data.forEach(function (m) {
            const first = (m.name && m.name.first) || '';
            const last = (m.name && m.name.last) || '';
            const official = (m.name && m.name['official_full']) || '';
            const fullPref = official || (first + ' ' + last);

            const candFull = normalize(fullPref);
            const candFirstLast = normalize(first + ' ' + last);

            const nameMatch =
              candFull.indexOf(qNorm) !== -1 ||
              candFirstLast.indexOf(qNorm) !== -1 ||
              (qFirst && qLast && candFull.indexOf(qFirst) !== -1 && candFull.indexOf(qLast) !== -1);
            if (!nameMatch) return;

            const terms = Array.isArray(m['terms']) ? m['terms'] : [];
            if (!terms.length) return;
            const lastTerm = terms[terms.length - 1];
            if (lastTerm.type === 'rep' || lastTerm.type === 'sen') {
              matches.push({ member: m, term: lastTerm });
            }
          });
        }
      } catch (e) {
        matches = [];
      }

      if (!matches.length) {
        $results.find('.alert-warning, .alert-danger').remove();
        const safeQuery = $('<div>').text(query).html();
        const alertHtml =
          '<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">\
            No members found for \'' + safeQuery + '\'.\
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\
          </div>';
        $results.prepend(alertHtml);
        return;
      }

      // Hide the main welcome section so results replace it
      $('#main').addClass('d-none');

      // Build a row of cards (one per match) and add it to the page
      let rowHtml = '<div class="row g-3">';
      for (let i = 0; i < matches.length; i++) {
        const m = matches[i].member;
        const t = matches[i].term;
        const fullName = (m.name && (m.name['official_full'] || (m.name.first + ' ' + m.name.last))) || 'Unknown';
        const party = (t && t['party']) ? t['party'] : '';
        const state = (t && t.state) ? t.state : '';
        const district = (t && (typeof t['district'] !== 'undefined')) ? t['district'] : null;
        const chamber = (t && t.type === 'sen') ? 'Senate' : 'House';
        const bioguide = (m.id && m.id['bioguide']) ? m.id['bioguide'] : null;
        const imgSrc = (function () {
          if (bioguide && chamber === 'House') {
            return 'https://clerk.house.gov/images/members/' + bioguide + '.jpg';
          }
          if (bioguide && chamber === 'Senate') {
            return 'https://raw.githubusercontent.com/argentargenticle/USA_Senate_Images/refs/heads/main/' + bioguide + '.jpg';
          }
          return 'https://placehold.co/150x200';
        })();
        const partyClass = (function () {
          const p = (party || '').toLowerCase();
          if (p.startsWith('dem')) return 'text-bg-primary';
          if (p.startsWith('rep')) return 'text-bg-danger';
          if (p.startsWith('ind')) return 'text-bg-warning';
          return 'text-bg-secondary';
        })();
        const btnClass = (function () {
          const p = (party || '').toLowerCase();
          if (p.startsWith('dem')) return 'btn-primary';
          if (p.startsWith('rep')) return 'btn-danger';
          if (p.startsWith('ind')) return 'btn-warning';
          return 'btn-secondary';
        })();

        rowHtml +=
          '<div class="col-12 col-md-6 col-lg-4">\
            <div class="card p-0 d-flex flex-row align-items-start h-100">\
              <img src="' + imgSrc + '" alt="Portrait" width="150" height="200" class="flex-shrink-0 rounded-start me-2">\
              <div class="p-2">\
                <h5 class="card-title">' + $('<div>').text(fullName).html() + '</h5>\
                <span class="card-text mb-2 badge ' + partyClass + '">' + $('<div>').text(party).html() + '</span>\
                <p class="text-muted mb-2"><i class="fas ' + (chamber === 'Senate' ? 'fa-scale-balanced' : 'fa-landmark') + ' me-2"></i>' + $('<div>').text(chamber).html() + '</p>\
                <p class="card-text mb-2">' + $('<div>').text(
                    (state ? getStateFullName(state) : '') + (district !== null ? ' - District ' + district : '')
                ).html() + '</p>\
                <button type="button" class="btn ' + btnClass + '">More Info</button>\
              </div>\
            </div>\
          </div>';
      }
      rowHtml += '</div>';

      $results.append(rowHtml);
    };
  });
</script>
</body>
</html>
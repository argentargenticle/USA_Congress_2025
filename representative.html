<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Basic Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/congress.js"></script>
</head>
<body>
<nav class="navbar bg-dark navbar-expand-lg py-2" data-bs-theme="dark">
    <div class="container">
        <a href="#" class="btn btn-light btn-lg d-flex align-items-center" id="backButton">
            <i class="fa-solid fa-arrow-left me-1 text-dark"></i>
            <span>Back</span>
        </a>
    </div>
</nav>

<main class="container mt-3">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="row g-0">
                <!-- Profile Image Column -->
                <div class="col-md-4 d-flex align-items-center justify-content-center p-4">
                    <div class="text-center">
                        <div class="position-relative d-inline-block mb-3">
                            <img id="profileImage" src="" alt="Profile Image"
                                 class="img-fluid rounded-5 border border-4 border-white shadow" style="width:
                                 200px; height: auto; object-fit: cover;">
                        </div>
                        <h4 id="representativeName" class="mb-0 fw-bold">No Representative Specified</h4>
                        <p id="chamberInfo" class="text-muted mb-0">-</p>
                    </div>
                </div>

                <!-- Information Column -->
                <div class="col-md-8">
                    <div class="card-body p-4">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100 border-0 bg-light p-3 rounded-3">
                                    <h6 class="text-uppercase text-muted small fw-bold mb-3">Official Information</h6>
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-landmark"></i></span>
                                            <span id="partyInfo"><strong>Party:</strong> -</span>
                                        </li>
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-clock"></i></span>
                                            <span id="termInfo"><strong>Term:</strong> -</span>
                                        </li>
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-hourglass-half"></i></span>
                                            <span id="congressTime"><strong>Time in Congress:</strong> -</span>
                                        </li>
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-building-columns"></i></span>
                                            <span id="chamberTime"><strong>Time in Chamber:</strong> -</span>
                                        </li>
                                        <li class="d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-calendar-check"></i></span>
                                            <span id="termCountdown"><strong>Term Ends In:</strong> -</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-0 bg-light p-3 rounded-3">
                                    <h6 class="text-uppercase text-muted small fw-bold mb-3">Personal Details</h6>
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-map-marker-alt"></i></span>
                                            <span id="stateInfo"><strong>State:</strong> -</span>
                                            <span id="districtInfo" class="ms-1"></span>
                                        </li>
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-birthday-cake"></i></span>
                                            <span id="birthdayInfo"><strong>Birthday:</strong> -</span>
                                        </li>
                                        <li class="mb-2 d-flex">
                                            <span class="text-muted me-2"><i class="fas fa-user"></i></span>
                                            <span id="ageInfo"><strong>Age:</strong> -</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Secondary Navigation -->
<div class="container my-2 my-md-3">
    <div class="row g-2 g-md-1 justify-content-center">
        <div class="col-12 col-sm-6 col-md-auto">
            <a id="ballotpediaLink" href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-landmark me-1"></i>
                <span>Ballotpedia</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-check-to-slot me-1"></i>
                <span>Vote Smart</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-money-bill-wave me-1"></i>
                <span>OpenSecrets</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-chart-line me-1"></i>
                <span>GovTrack</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-arrow-trend-up me-1"></i>
                <span>Unusual Whales</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-hand-holding-usd me-1"></i>
                <span>Track AIPAC</span>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-md-auto">
            <a href="#" class="btn btn-light w-100 text-start border-0 rounded-pill px-3 text-dark shadow-sm">
                <i class="fas fa-university me-1"></i>
                <span>Congress.gov</span>
            </a>
        </div>
    </div>
</div>

<footer class="container py-3 text-muted border-top">
    <small>Argenticle @Copyright 2025 </small>
</footer>
<script>
    // Function to get URL parameters
    function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    // Function to calculate age from birthdate
    function calculateAge(birthdate) {
        const birthDate = new Date(birthdate);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();
        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        return age;
    }

    // Function to calculate time in Congress
    function getTimeInCongress(terms) {
        const firstTerm = terms[0];
        const startDate = new Date(firstTerm.start);
        const today = new Date();
        
        let years = today.getFullYear() - startDate.getFullYear();
        let months = today.getMonth() - startDate.getMonth();
        
        if (months < 0 || (months === 0 && today.getDate() < startDate.getDate())) {
            years--;
            months += 12;
        }
        
        return `${years} year${years !== 1 ? 's' : ''} ${months} month${months !== 1 ? 's' : ''}`;
    }

    // Function to calculate time in current chamber
    function getTimeInChamber(terms, currentTerm) {
        const chamberTerms = terms.filter(term => term.type === currentTerm.type);
        return getTimeInCongress(chamberTerms, currentTerm);
    }

    // Function to calculate time until term ends in years, months, and days
    function getTermCountdown(endDate) {
        const end = new Date(endDate);
        const today = new Date();
        
        if (end < today) {
            const formattedEndDate = end.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            return `Term ended on ${formattedEndDate}`;
        }
        
        let years = end.getFullYear() - today.getFullYear();
        let months = end.getMonth() - today.getMonth();
        let days = end.getDate() - today.getDate();
        
        if (days < 0) {
            months--;
            // Get the last day of the previous month
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            days += lastDayOfMonth;
        }
        
        if (months < 0) {
            years--;
            months += 12;
        }
        
        const parts = [];
        if (years > 0) parts.push(`${years} year${years !== 1 ? 's' : ''}`);
        if (months > 0) parts.push(`${months} month${months !== 1 ? 's' : ''}`);
        if (days > 0 || parts.length === 0) parts.push(`${days} day${days !== 1 ? 's' : ''}`);
        
        return parts.join(', ');
    }

    // Get URL parameters
    const bioguideId = getUrlParameter('bioguide');
    const source = getUrlParameter('source');
    
    // Update back button link if source is 'home'
    if (source === 'home') {
        $('#backButton span').text('Back to House');
        $('#backButton').attr('href', 'index.html');
    }
    
    if (bioguideId) {
        $.getJSON('https://unitedstates.github.io/congress-legislators/legislators-current.json')
            .done(function(data) {
                // Find the representative with matching bioguide ID
                const rep = data.find(rep => rep.id['bioguide'] === bioguideId);
                
                if (rep && rep['terms'] && rep['terms'].length > 0) {
                    // Get the latest term
                    const terms = rep['terms'];
                    const latestTerm = terms[terms.length - 1];
                    
                    // Format the full name
                    const name = rep.name;
                    const fullName =
                        `${name.first} ${name['middle'] ? name['middle'] + ' ' : ''}${name.last}${name.suffix
                        ? ' ' + name.suffix : ''}`;
                    
                    // Calculate additional information
                    const birthdate = rep['bio'] ? rep['bio']['birthday'] : (rep['birthday'] || null);
                    const age = birthdate ? calculateAge(birthdate) : 'N/A';
                    const termStart = new Date(latestTerm.start).getFullYear();
                    const termEnd = new Date(latestTerm.end).getFullYear();
                    const timeInChamber = getTimeInChamber(rep['terms'], latestTerm);
                    
                    // Format birthday if available
                    let birthdayFormatted = 'N/A';
                    if (birthdate) {
                        const birthdayDate = new Date(birthdate);
                        birthdayFormatted = birthdayDate.toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    }
                    
                    // Update party badge, body class, and icon colors
                    const party = latestTerm['party'] || '';
                    let badgeClass = 'bg-secondary';
                    let textColorClass = 'text-secondary';
                    
                    if (party.includes('Democrat')) {
                        badgeClass = 'bg-primary';
                        textColorClass = 'text-primary';
                        $('body').addClass('bg-primary-subtle');
                    } else if (party.includes('Republican')) {
                        badgeClass = 'bg-danger';
                        textColorClass = 'text-danger';
                        $('body').addClass('bg-danger-subtle');
                    } else {
                        $('body').addClass('bg-light');
                    }
                    
                    // Update all icons with the party color
                    $('.fa-solid, .fas').addClass(textColorClass);
                    
                    // Update Ballotpedia link with representative's ballotpedia ID
                    const ballotpediaId = rep.id['ballotpedia'] || fullName.replace(/\s+/g, '_');
                    $('#ballotpediaLink').attr('href', `https://ballotpedia.org/${ballotpediaId}`);
                    
                    // Set Vote Smart link with ID and name from JSON
                    const votesmartId = rep.id['votesmart']; // Fallback to default if not found
                    const votesmartName = fullName.toLowerCase().replace(/\s+/g, '-');
                    $('a:contains("Vote Smart")').attr('href', `https://justfacts.votesmart.org/candidate/biography/${votesmartId}/${votesmartName}`);
                    
                    // Set OpenSecrets link with Ballotpedia ID in URL and opensecrets ID as cid
                    const currentYear = new Date().getFullYear();
                    const opensecretsId = rep.id.opensecrets || '';
                    $('a:contains("OpenSecrets")').attr('href', `https://www.opensecrets.org/members-of-congress/${ballotpediaId}/summary?cid=${opensecretsId}&cycle=${currentYear}`);
                    
                    // Set GovTrack link
                    const govtrackId = rep.id.govtrack || '';
                    $('a:contains("GovTrack")').attr('href', `https://www.govtrack.us/congress/members/${govtrackId}`);
                    
                    // Update the representative's information
                    $('#representativeName').text(fullName);
                    $('#chamberInfo').text(latestTerm.type === 'rep' ? 'House of Representatives' : 'Senate');
                    $('#partyBadge').removeClass().addClass(`position-absolute bottom-0 end-0 translate-middle badge rounded-pill ${badgeClass} fs-6`);
                    
                    // Update information cards
                    $('#partyInfo').html(`<strong>Party:</strong> ${party}`);
                    $('#termInfo').html(`<strong>Term:</strong> ${termStart} - ${termEnd}`);
                    $('#congressTime').html(`<strong>Time in Congress:</strong> ${getTimeInCongress(rep['terms'])}`);
                    $('#termCountdown').html(`<strong>Term Ends In:</strong> ${getTermCountdown(latestTerm.end)}`);
                    
                    // Update personal details
                    $('#stateInfo').html(`<strong>State:</strong> ${getStateFullName(latestTerm.state)}`);
                    const district = latestTerm['district'] ? `- District ${latestTerm['district']}` : '';
                    $('#districtInfo').text(district);
                    $('#birthdayInfo').html(`<strong>Birthday:</strong> ${birthdayFormatted}`);
                    $('#ageInfo').html(`<strong>Age:</strong> ${age}`);
                    $('#chamberTime').html(`<strong>Time in Chamber:</strong> ${timeInChamber}`);
                    
                    // Set profile image with error handling
                    const profileImage = $('#profileImage');
                    if (latestTerm.type === 'sen') {
                        // Use GitHub URL for senators
                        profileImage.attr('src', `https://raw.githubusercontent.com/argentargenticle/USA_Senate_Images/main/${bioguideId}.jpg`);
                    } else {
                        // Use House URL for representatives
                        profileImage.attr('src', `https://clerk.house.gov/images/members/${bioguideId}.jpg`);
                    }
                    profileImage.on('error', function() {
                        $(this).attr('src', 'https://via.placeholder.com/300x400?text=No+Image+Available');
                    });
                } else {
                    console.error('Representative not found with bioguide ID:', bioguideId);
                    $('#representativeName').text('Representative Not Found');
                }
            })
            .fail(function(error) {
                console.error('Error loading data:', error);
                $('#representativeName').text('Error Loading Data');
            });
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Legislator Info with Committee Roles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            font-size: 16px;
            padding: 0;
            margin: 0 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 0 0;
        }

        /* Header & Navigation */
        #menu {
            background-color: var(--primary);
            padding: 1rem 20px;
            margin: 0 -20px 0;
        }

        #menu ul {
            list-style-type: none;
            display: flex;
            gap: 1rem;
            padding: 0;
            max-width: 1200px;
            margin: 0 auto;
        }

        #menu ul li a {
            display: inline-block;
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1.25rem;
            border-radius: 50px;
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
        }

        #menu ul li a:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Profile Section */
        .profile-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin: 2rem 0;
            align-items: flex-start;
        }

        .portrait-container {
            flex: 0 0 250px;
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            background: white;
        }

        #portraitImg {
            width: 100%;
            height: auto;
            display: block;
            transition: var(--transition);
        }

        .portrait-container:hover #portraitImg {
            transform: scale(1.02);
        }

        .info-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: var(--box-shadow);
        }

        .info-card h3, .committee-section h2 {
            color: var(--primary);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--light-gray);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .info-card h3 i, .committee-section h2 i {
            color: var(--secondary);
            font-size: 1.4em;
            width: 1.5em;
            text-align: center;
        }

        /* Committee Section Styles */
        .committee-section {
            margin-top: 2rem;
        }

        .committee-section h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .section-subtitle {
            color: var(--gray);
            margin: -1rem 0 1.5rem;
            font-style: italic;
            font-size: 0.95rem;
        }

        .committee-section h3 {
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
        }

        .committee-section h3 i {
            color: var(--secondary);
            width: 1.5em;
            text-align: center;
        }

        .role-list {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 1.5rem;
        }

        .role-list li {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: var(--transition);
            border-left: 3px solid var(--secondary);
        }

        .role-list li:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .role-list li i {
            color: var(--secondary);
            width: 1.5em;
            text-align: center;
            opacity: 0.8;
        }

        .empty-state {
            color: var(--gray);
            font-style: italic;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        .info-item {
            background: var(--light);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            border-left: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 1rem;
            height: 100%;
        }

        .info-icon {
            font-size: 1.25rem;
            color: var(--secondary);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .info-content {
            flex: 1;
        }

        .info-item strong {
            display: block;
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-item p {
            color: var(--dark);
            font-size: 1.1rem;
            margin: 0;
            font-weight: 500;
        }

        .info-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }


        .info p {
            margin: 0.75rem 0;
            color: var(--dark);
        }

        .info strong {
            color: var(--primary);
            margin-right: 0.5rem;
        }

        /* Links Section */
        #links {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: var(--box-shadow);
        }

        #links h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--light-gray);
        }

        #links ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin: 0;
            padding: 0;
            background: none;
            border-radius: 0;
        }

        #links ul li a {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--light-gray);
            border-radius: 50px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid rgba(0,0,0,0.05);
            margin: 0;
        }

        #links ul li a:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Info Button */
        #moreInfoBtn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            margin: 0.5rem 0;
        }

        #moreInfoBtn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        #moreInfoBtn:active {
            transform: translateY(0);
        }

        #linksExplanation {
            display: none;
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: var(--box-shadow);
        }

        #linksExplanation p {
            margin: 0.5rem 0;
            color: var(--dark);
            line-height: 1.6;
        }

        /* Committee Section */
        #committeeAssignments {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin: 3rem 0;
            box-shadow: var(--box-shadow);
        }

        #committeeAssignments h2 {
            color: var(--primary);
            margin-bottom: 2rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--light-gray);
        }

        #committeeAssignments h3 {
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            font-size: 1.25rem;
        }

        #committeeAssignments ul {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem;
        }

        #committeeAssignments ul li {
            background: var(--light);
            padding: 1rem 1.25rem;
            margin: 0.5rem 0;
            border-radius: var(--border-radius);
            transition: var(--transition);
            border-left: 3px solid var(--secondary);
        }

        #committeeAssignments ul li:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .profile-container {
                flex-direction: column;
            }
            
            .portrait-container {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .info {
                width: 100%;
                min-width: auto;
            }
            
            #links ul {
                flex-direction: column;
            }
            
            #links ul li a {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div id="menu">
    <ul>
        <li id="backLink"><a href="#">Back</a></li>
    </ul>
</div>
<div class="container">
    <div class="profile-container">
        <div class="portrait-container">
            <img id="portraitImg" alt="Legislator Portrait" />
        </div>
        <div class="info">
            <h1 id="officialFullName">Loading...</h1>
            <div id="nicknameContainer" class="meta-tag" style="display:none">
                <strong>Nickname:</strong> <span id="nickname"></span>
            </div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-icon"><i class="fas fa-flag-usa"></i></div>
                    <div class="info-content">
                        <strong>State</strong>
                        <p id="stateFullName">Loading...</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <div class="info-content">
                        <strong>District</strong>
                        <p id="districtNum">-</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon" id="partyIcon"><i class="fas fa-landmark"></i></div>
                    <div class="info-content">
                        <strong>Party</strong>
                        <p id="party">Loading...</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon"><i class="far fa-calendar-alt"></i></div>
                    <div class="info-content">
                        <strong>Term</strong>
                        <p><span id="termStart">Loading</span> - <span id="termEnd">Loading</span></p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon"><i class="far fa-clock"></i></div>
                    <div class="info-content">
                        <strong>Time Remaining</strong>
                        <p id="termCountdown">Loading...</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon"><i class="fas fa-university"></i></div>
                    <div class="info-content">
                        <strong>Chamber</strong>
                        <p id="chamber">Loading...</p>
                    </div>
                </div>
                <div class="info-item" id="senateClassItem" style="display: none;">
                    <div class="info-icon"><i class="fas fa-layer-group"></i></div>
                    <div class="info-content">
                        <strong>Senate Class</strong>
                        <p id="senateClass">-</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="links">
        <h2>External Resources</h2>
        <ul>
            <li><a href="#" id="ballotpedia" target="_blank" rel="noopener noreferrer">Ballotpedia</a></li>
            <li><a href="#" id="votesmart" target="_blank" rel="noopener noreferrer">Vote Smart</a></li>
            <li><a href="#" id="opensecrets" target="_blank" rel="noopener noreferrer">Open Secrets</a></li>
            <li><a href="#" id="govtrack" target="_blank" rel="noopener noreferrer">GovTrack</a></li>
            <li><a href="#" id="unusualWhales" target="_blank" rel="noopener noreferrer">Unusual Whales</a></li>
            <li><a href="#" id="trackAIPAC" target="_blank" rel="noopener noreferrer">Track AIPAC</a></li>
        </ul>
    </div>
    
    <button id="moreInfoBtn">
        <i class="fas fa-info-circle"></i> About These Links
    </button>
    
    <div id="linksExplanation">
        <p><strong>Ballotpedia:</strong> An online encyclopedia of American politics and elections.</p>
        <p><strong>Vote Smart:</strong> Provides biographical, voting record, and interest group ratings for politicians. Users get 5 free views per day before needing to create a free account to continue viewing pages.</p>
        <p><strong>OpenSecrets:</strong> Tracks campaign contributions and lobbying expenditures.</p>
        <p><strong>GovTrack:</strong> Tracks bills, votes, and legislator profiles in Congress.</p>
        <p><strong>Unusual Whales:</strong> Tracks unusual options trading activity related to politicians.</p>
        <p><strong>Track AIPAC:</strong> Tracks campaign contributions and political influence related to the American Israel Public Affairs Committee.</p>
    </div>
    <div class="info-card">
        <h3><i class="fas fa-user-circle"></i> Biographical Information</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-icon"><i class="fas fa-birthday-cake"></i></div>
                <div class="info-content">
                    <strong>Birthday</strong>
                    <p id="birthday">Loading...</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon"><i class="fas fa-user-clock"></i></div>
                <div class="info-content">
                    <strong>Age</strong>
                    <p id="age">Loading...</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon"><i class="fas fa-hourglass-half"></i></div>
                <div class="info-content">
                    <strong>Time in Office</strong>
                    <p id="tenure">Loading...</p>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon"><i class="fas fa-flag"></i></div>
                <div class="info-content">
                    <strong>Started in Congress</strong>
                    <p id="startDates">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="committeeAssignments" class="committee-section">
        <h2><i class="fas fa-tasks"></i> Committee Assignments</h2>
        <p class="section-subtitle">Current committee and subcommittee roles</p>
        
        <h3><i class="fas fa-gavel"></i> Chairman</h3>
        <ul id="chairmanList" class="role-list">
            <li class="empty-state"><i class="fas fa-info-circle"></i> No chairman roles</li>
        </ul>
        
        <h3><i class="fas fa-user-tie"></i> Ranking Member</h3>
        <ul id="rankingMemberList" class="role-list">
            <li class="empty-state"><i class="fas fa-info-circle"></i> No ranking member roles</li>
        </ul>
        
        <h3><i class="fas fa-users"></i> Member</h3>
        <ul id="memberList" class="role-list">
            <li class="empty-state"><i class="fas fa-info-circle"></i> No member roles</li>
        </ul>
    </div>
</div>
<script>
    // language=JQuery-CSS
    const selector = ".representative-card";
    const votingStates = new Set([
        "AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA",
        "KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
        "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT",
        "VA","WA","WV","WI","WY"
    ]);

    const stateNames = {
        "AL":"Alabama","AK":"Alaska","AS":"American Samoa","AZ":"Arizona","AR":"Arkansas","CA":"California","CO":"Colorado","CT":"Connecticut","DE":"Delaware",
        "DC":"District Of Columbia","FL":"Florida","GA":"Georgia","GU":"Guam","HI":"Hawaii","ID":"Idaho","IL":"Illinois","IN":"Indiana","IA":"Iowa","KS":"Kansas",
        "KY":"Kentucky","LA":"Louisiana","ME":"Maine","MH":"Marshall Islands","MD":"Maryland","MA":"Massachusetts","MI":"Michigan","MN":"Minnesota","MS":"Mississippi",
        "MO":"Missouri","MT":"Montana","NE":"Nebraska","NV":"Nevada","NH":"New Hampshire","NJ":"New Jersey","NM":"New Mexico","NY":"New York","NC":"North Carolina",
        "ND":"North Dakota","NP":"Northern Mariana Islands","OH":"Ohio","OK":"Oklahoma","OR":"Oregon","PA":"Pennsylvania","PR":"Puerto Rico","RI":"Rhode Island",
        "SC":"South Carolina","SD":"South Dakota","TN":"Tennessee","TX":"Texas","VI":"US Virgin Islands","UT":"Utah","VT":"Vermont","VA":"Virginia","WA":"Washington",
        "WV":"West Virginia","WI":"Wisconsin","WY":"Wyoming"
    };

    // Toggle for info button
    document.addEventListener('DOMContentLoaded', function() {
        const infoButton = document.getElementById('moreInfoBtn');
        const infoContent = document.getElementById('linksExplanation');
        
        if (infoButton && infoContent) {
            infoButton.addEventListener('click', function(e) {
                e.preventDefault();
                if (infoContent.style.display === 'none' || !infoContent.style.display) {
                    infoContent.style.display = 'block';
                    this.textContent = 'Less Info';
                } else {
                    infoContent.style.display = 'none';
                    this.textContent = 'More Info';
                }
            });
        }
    });

    // Helper functions
    function calculateAge(dateStr){
        if(!dateStr) return "N/A";
        const d = new Date(dateStr), t = new Date();
        let a = t.getFullYear() - d.getFullYear();
        if(t.getMonth() < d.getMonth() || (t.getMonth()===d.getMonth() && t.getDate()<d.getDate())) a--;
        return a;
    }
    function formatLongDate(dateStr){
        if(!dateStr) return "N/A";
        const d=new Date(dateStr);
        if(isNaN(d)) return "N/A";
        return d.toLocaleDateString("en-US", {weekday:"long", year:"numeric", month:"long", day:"numeric"});
    }
    function formatTermDate(dateStr){
        if(!dateStr) return "N/A";
        const d=new Date(dateStr);
        if(isNaN(d)) return "N/A";
        return d.getFullYear();
    }
    function calculateCountdown(endDateStr){
        if(!endDateStr) return "N/A";
        const now = new Date(), end = new Date(endDateStr);
        if(end <= now) return "Term ended";
        let y = end.getFullYear() - now.getFullYear();
        let m = end.getMonth() - now.getMonth();
        let d = end.getDate() - now.getDate();
        if(d < 0){ m--; d += new Date(end.getFullYear(), end.getMonth(), 0).getDate(); }
        if(m < 0){ y--; m += 12; }
        let parts = [];
        if(y > 0) parts.push(y + " year" + (y>1?"s":""));
        if(m > 0) parts.push(m + " month" + (m>1?"s":""));
        parts.push(d + " day" + (d!==1?"s":""));
        return parts.join(", ");
    }
    function calculateTenure(startDateStr){
        if(!startDateStr) return "N/A";
        const now = new Date(), start = new Date(startDateStr);
        if(start > now) return "N/A";
        let y = now.getFullYear() - start.getFullYear();
        let m = now.getMonth() - start.getMonth();
        let d = now.getDate() - start.getDate();
        if(d < 0){ m--; d += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
        if(m < 0){ y--; m += 12; }
        let parts = [];
        if(y > 0) parts.push(y + " year" + (y>1?"s":""));
        if(m > 0) parts.push(m + " month" + (m>1?"s":""));
        if(d > 0) parts.push(d + " day" + (d!==1?"s":""));
        return parts.length ? parts.join(", ") : "Less than a day";
    }

    function linkifyBallotpediaOrName(id, wikipediaName, officialName) {
        if (id && id !== "N/A") {
            return `<a href="https://ballotpedia.org/${encodeURIComponent(id.replace(/ /g, "_"))}" target="_blank">Ballotpedia</a>`;
        } else if (wikipediaName) {
            const slug = encodeURIComponent(wikipediaName.replace(/ /g, "_"));
            return `<a href="https://ballotpedia.org/${slug}" target="_blank">Ballotpedia</a>`;
        } else if (officialName) {
            const slug = encodeURIComponent(officialName.replace(/ /g, "_"));
            return `<a href="https://ballotpedia.org/${slug}" target="_blank">Ballotpedia</a>`;
        } else {
            return "N/A";
        }
    }
    function linkifyVoteSmart(id) {
        if (!id || id === "N/A") return "N/A";
        return `<a href="https://justfacts.votesmart.org/candidate/biography/${id}/" target="_blank">Vote Smart</a>`;
    }
    function linkifyOpenSecrets(id, n) {
        if (!id || id === "N/A" || !n || n === "N/A") return "N/A";
        const url = n.replace(/ /g, "-").replace(/[^a-zA-Z0-9\-]/g, "");
        return `<a href="https://www.opensecrets.org/members-of-congress/${url}/summary?cid=${id}" target="_blank">Open Secrets</a>`;
    }
    function linkifyGovTrack(id) {
        if (!id || id === "N/A") return "N/A";
        return `<a href="https://www.govtrack.us/congress/members/${id}" target="_blank">GovTrack</a>`;
    }
    function linkifyUnusualWhales(wikipediaName, officialName) {
        let name = "";
        if (wikipediaName) {
            name = wikipediaName;
        } else if (officialName) {
            name = officialName;
        } else {
            return "N/A";
        }
        const encodedName = encodeURIComponent(name);
        return `<a href="https://unusualwhales.com/politics/profile/${encodedName}" target="_blank">Unusual Whales</a>`;
    }
    function linkifyTrackAIPAC(stateFullName, wikipediaName, officialName) {
        if (!stateFullName) return "N/A";
        const stateLower = stateFullName.toLowerCase().replace(/ /g, "");
        let namePart = "";
        if (wikipediaName) {
            namePart = wikipediaName;
        } else if (officialName) {
            namePart = officialName;
        } else {
            return "N/A";
        }
        const encodedName = encodeURIComponent(namePart);
        return `<a href="https://www.trackaipac.com/states/${stateLower}?rq=${encodedName}" target="_blank">Track AIPAC</a>`;
    }

    // Extract bioguide ID and source from query params
    const queryString = window.location.search.slice(1);
    const [bioguideId, sourceParam] = queryString.split('?');
    const source = sourceParam ? sourceParam.split('=')[1] : 'house'; // Default to house if no source specified

    // Set the back link based on source
    const backLink = document.getElementById('backLink');
    if (source === 'senate') {
        backLink.innerHTML = '<a href="senate.html"><i class="fas fa-arrow-left"></i> Back to Senate</a>';
    } else if (source === 'house') {
        backLink.innerHTML = '<a href="house.html"><i class="fas fa-arrow-left"></i> Back to House</a>';
    } else {
        // Handle committee source (thomas_id)
        backLink.innerHTML = `<a href="committee-individual.html?thomas_id=${source}"><i class="fas fa-arrow-left"></i> Back to Committee</a>`;
    }

    // Initialize variables
    let stateAbbr = "N/A";
    let districtNum = "N/A";

    // These will be set after we find the legislator
    let currentState = "";
    let currentDistrict = "";

    Promise.all([
        fetch("https://unitedstates.github.io/congress-legislators/legislators-current.json").then(r=>r.json()),
        fetch("https://unitedstates.github.io/congress-legislators/committee-membership-current.json").then(r=>r.json()),
        fetch("https://unitedstates.github.io/congress-legislators/committees-current.json").then(r=>r.json())
    ]).then(([legislatorsData, membershipData, committeesData])=>{
        const today=new Date();

        // Find legislator by bioguide ID
        let legislator = legislatorsData.find(leg => leg.id.bioguide === bioguideId);

        if (legislator) {
            const term = legislator.terms[legislator.terms.length-1];
            stateAbbr = term.state;
            districtNum = term.district ? term.district.toString() : "N/A";
            currentState = stateNames[stateAbbr] || "Unknown";
            currentDistrict = districtNum;

            // Update the UI with state and district info
            document.getElementById("stateFullName").textContent = currentState;
            document.getElementById("districtNum").textContent = currentDistrict;
        }

        if(!legislator){
            document.getElementById("officialFullName").textContent="No current representative found";
            ["nickname","birthday","age","party","termStart","termEnd","termCountdown","chamber"].forEach(id=>document.getElementById(id).textContent="");
            ["chairmanList","rankingMemberList","memberList"].forEach(id=>document.getElementById(id).innerHTML="<li>None</li>");
            document.getElementById("portraitImg").src="";
            document.getElementById("unusualWhales").textContent = "";
            document.getElementById("trackAIPAC").textContent = "";
            return;
        }

        const t=legislator.terms[legislator.terms.length-1];
        if(districtNum==="AUTO") document.getElementById("districtNum").textContent = t.district || "At-Large";

        const officialName=legislator.name.official_full;
        const wikipediaName=legislator.id.wikipedia || "";
        const fullStateName = stateNames[stateAbbr] || "";

        document.getElementById("officialFullName").textContent=officialName;
        if(legislator.bio?.nickname){
            document.getElementById("nicknameContainer").style.display="block";
            document.getElementById("nickname").textContent=legislator.bio.nickname;
        }
        document.getElementById("birthday").textContent=formatLongDate(legislator.bio?.birthday);
        document.getElementById("age").textContent=calculateAge(legislator.bio?.birthday);
        const isSenator = t.type === "sen";
        const chamber = isSenator ? "Senate" : "House";
        document.getElementById("chamber").textContent = chamber;
        
        // Show/hide and set Senate class
        const senateClassItem = document.getElementById("senateClassItem");
        const senateClassEl = document.getElementById("senateClass");
        if (isSenator) {
            senateClassItem.style.display = 'flex';
            senateClassEl.textContent = `Class ${t.class}`;
        } else if (senateClassItem) {
            senateClassItem.style.display = 'none';
        }
        
        // Hide district info for Senate
        const districtItem = document.querySelector('.info-item:has(#districtNum)');
        if (t.type === "sen" && districtItem) {
            districtItem.style.display = 'none';
        } else if (districtItem) {
            districtItem.style.display = 'flex'; // Ensure it's visible for House
        }
        
        // Set party text and update color scheme
        document.getElementById("party").textContent = t.party;
        // Update --secondary color and party icon based on party
        const root = document.documentElement;
        const partyIcon = document.getElementById("partyIcon");
        if (t.party === "Republican") {
            root.style.setProperty('--secondary', '#E04B52'); // Republican red
            partyIcon.innerHTML = '<i class="fas fa-republican"></i>';
        } else if (t.party === "Democrat") {
            root.style.setProperty('--secondary', '#5B8FF5'); // Democrat blue
            partyIcon.innerHTML = '<i class="fas fa-democrat"></i>';
        } else {
            root.style.setProperty('--secondary', '#9B59B6'); // Independent purple
            partyIcon.innerHTML = '<i class="fas fa-star"></i>';
        }

        // Set up external resource links
        const setLink = (id, url, text) => {
            const element = document.getElementById(id);
            if (element) {
                element.href = url;
                element.textContent = text || id.charAt(0).toUpperCase() + id.slice(1);
            }
        };

        setLink("ballotpedia", `https://ballotpedia.org/${encodeURIComponent(wikipediaName || officialName.replace(/ /g, '_'))}`, "Ballotpedia");
        if (legislator.id.votesmart) setLink("votesmart", `https://justfacts.votesmart.org/candidate/biography/${legislator.id.votesmart}`, "Vote Smart");
        if (legislator.id.opensecrets) setLink("opensecrets", `https://www.opensecrets.org/members-of-congress/${officialName.replace(/ /g, '-')}/summary?cid=${legislator.id.opensecrets}`, "OpenSecrets");
        if (legislator.id.govtrack) setLink("govtrack", `https://www.govtrack.us/congress/members/${legislator.id.govtrack}`, "GovTrack");
        setLink("unusualWhales", `https://unusualwhales.com/politics/profile/${encodeURIComponent(officialName)}`, "Unusual Whales");
        setLink("trackAIPAC", `https://www.trackaipac.com/states/${stateAbbr.toLowerCase()}?rq=${encodeURIComponent(officialName)}`, "Track AIPAC");

        const termStart=formatTermDate(t.start), termEnd=formatTermDate(t.end);
        document.getElementById("termStart").textContent=termStart;
        document.getElementById("termEnd").textContent=termEnd;
        document.getElementById("termCountdown").textContent=calculateCountdown(t.end);

        const firstTerm = legislator.terms[0].start;
        const tenureCongress = calculateTenure(firstTerm);
        document.getElementById("startDates").textContent = formatLongDate(firstTerm);
        document.getElementById("tenure").textContent = tenureCongress;

        // Set background color based on party
        document.body.style.backgroundColor = 
            t.party === "Republican" ? "#ffcccc" : 
            t.party === "Democrat" ? "#cce5ff" :
            "#f0e6ff"; // Light purple for independents/other

        // Set portrait image source based on source parameter
        const portraitImg = document.getElementById("portraitImg");
        if (source === 'senate' || source === 'SSAP') {
            portraitImg.src = `https://raw.githubusercontent.com/argentargenticle/USA_Senate_Images/refs/heads/main/${legislator.id.bioguide}.jpg`;
        } else {
            portraitImg.src = `https://clerk.house.gov/images/members/${legislator.id.bioguide}.jpg`;
        }
        portraitImg.alt = `Portrait of ${officialName}`;

        // Committees
        const bioguide = legislator.id.bioguide;
        const committeeMap = {};

        committeesData.forEach(comm=>{
            if(comm.thomas_id) committeeMap[comm.thomas_id] = comm;
            (comm.subcommittees||[]).forEach(sub=>{
                if(sub.thomas_id) committeeMap[comm.thomas_id+sub.thomas_id] = {
                    name: `${comm.name} - ${sub.name}`
                };
            });
        });

        let chairman=[], ranking=[], member=[];
        for(const committeeId in membershipData){
            membershipData[committeeId].forEach(m=>{
                if(m.bioguide === bioguide){
                    let name = committeeMap[committeeId] ? committeeMap[committeeId].name : committeeId;
                    if(m.subcommittee){
                        const subKey = committeeId + m.subcommittee;
                        if(committeeMap[subKey]) name = committeeMap[subKey].name;
                    }
                    const title = m.title || "Member";
                    const entry = `${name} (${title})`;
                    const titleLower = title.toLowerCase();
                    if(titleLower.includes("chair")){
                        chairman.push(entry);
                    } else if(titleLower.includes("ranking")){
                        ranking.push(entry);
                    } else {
                        member.push(entry);
                    }
                }
            });
        }

        function fillList(id, items){
            document.getElementById(id).innerHTML = items.length ? items.map(i=>`<li>${i}</li>`).join("") : "<li>None</li>";
        }

        fillList("chairmanList", chairman);
        fillList("rankingMemberList", ranking);
        fillList("memberList", member);

    }).catch(err=>{
        console.error(err);
        document.getElementById("officialFullName").textContent="Error loading legislator data";
        document.getElementById("unusualWhales").textContent = "";
        document.getElementById("trackAIPAC").textContent = "";
    });
</script>
</body>
</html>
